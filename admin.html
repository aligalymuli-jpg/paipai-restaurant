<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω–∫–∞ | Pai Pai</title>
    <link rel="stylesheet" href="style.css?v=18.0">
    <style>
        #admin-content {
            display: none;
            padding: 20px;
        }
        
        .admin-box {
            max-width: 500px;
            margin: 0 auto;
            background: #111;
            padding: 25px;
            border-radius: 20px;
            border: 1px solid #c48c5d;
        }
        
        input,
        select,
        textarea {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            background: #222;
            color: white;
            border: 1px solid #444;
            border-radius: 10px;
            font-size: 1rem;
        }
        
        textarea {
            height: 80px;
            resize: none;
        }
        
        .upload-area {
            border: 2px dashed #444;
            padding: 30px;
            text-align: center;
            border-radius: 15px;
            cursor: pointer;
            margin: 15px 0;
            display: block;
        }
        
        #img-preview {
            width: 100%;
            max-height: 200px;
            object-fit: contain;
            display: none;
            margin-top: 15px;
            border-radius: 10px;
        }
        
        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #333;
        }
        
        .btn-delete {
            color: #ff4d4d;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div id="login-form" style="height: 100vh; display: flex; align-items: center; justify-content: center;">
        <div class="admin-box" style="text-align: center;">
            <h2 style="font-family: 'Marck Script', cursive; color: #c48c5d; font-size: 2.5rem;">–ê–¥–º–∏–Ω–∫–∞</h2>
            <input type="password" id="admin-pass" placeholder="–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞">
            <button onclick="login()" class="btn-sm" style="margin-top: 15px; height: 50px; width: 100%;">–í–æ–π—Ç–∏</button>
        </div>
    </div>

    <div id="admin-content"></div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDU7Q6LOha4gIBz6HoHyx3Nx7LwWi4dSls",
            authDomain: "ali1-717e6.firebaseapp.com",
            databaseURL: "https://ali1-717e6-default-rtdb.firebaseio.com",
            projectId: "ali1-717e6"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const imgbbKey = "19b2ea0cacae4c9328806e4c678db140";

        function login() {
            const pass = document.getElementById('admin-pass').value;
            db.ref('admin_settings/pass').once('value').then(s => {
                if (pass === s.val()) {
                    document.getElementById('login-form').remove();
                    const content = document.getElementById('admin-content');
                    content.style.display = 'block';
                    content.innerHTML = `
                        <div class="admin-box">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <a href="index.html" style="color:#c48c5d; text-decoration: none;">‚Üê –ù–∞ —Å–∞–π—Ç</a>
                                <button onclick="location.reload()" style="background:none; border:none; color:#666;">–í—ã–π—Ç–∏</button>
                            </div>
                            <h2 style="margin: 20px 0;">–ù–æ–≤–æ–µ –±–ª—é–¥–æ</h2>
                            <input type="text" id="p-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ü–ª–æ–≤)">
                            <input type="number" id="p-price" placeholder="–¶–µ–Ω–∞ (—Ç–≥)">
                            <textarea id="p-desc" placeholder="–°–æ—Å—Ç–∞–≤ –±–ª—é–¥–∞..."></textarea>
                            <input type="text" id="p-count" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –Ω–∞ 5-6 —á–µ–ª)">
                            
                            <label style="color: #c48c5d; font-size: 0.9rem;">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                            <select id="p-cat">
                                <option value="first">–ü–µ—Ä–≤—ã–µ –±–ª—é–¥–∞</option>
                                <option value="second">–í—Ç–æ—Ä—ã–µ –±–ª—é–¥–∞</option>
                                <option value="bakery">–í—ã–ø–µ—á–∫–∞</option>
                                <option value="salad">–°–∞–ª–∞—Ç—ã</option>
                                <option value="group">–ù–∞ –∫–æ–º–ø–∞–Ω–∏—é</option>
                                <option value="semi">–ü–æ–ª—É—Ñ–∞–±—Ä–∏–∫–∞—Ç—ã</option>
                                <option value="coffee">–ù–∞–ø–∏—Ç–∫–∏</option>
                                <option value="dessert">–î–µ—Å–µ—Ä—Ç—ã</option>
                                <option value="sauce">–°–æ—É—Å—ã/–•–ª–µ–±</option>
                                <option value="dishes">–ü–æ—Å—É–¥–∞</option>
                            </select>

                            <label style="color: #c48c5d; font-size: 0.9rem;">–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å (–±–µ–π–¥–∂):</label>
                            <select id="product-badge">
                                <option value="">–ë–µ–∑ –±–µ–π–¥–∂–∞</option>
                                <option value="hit">–•–ò–¢ üî•</option>
                                <option value="new">–ù–û–í–ò–ù–ö–ê ‚ú®</option>
                            </select>

                            <label class="upload-area">
                                <input type="file" id="p-file" accept="image/*" style="display:none;" onchange="showPreview(this)">
                                <span id="upload-label">üì∏ –í—ã–±—Ä–∞—Ç—å —Ñ–æ—Ç–æ –∏–∑ –≥–∞–ª–µ—Ä–µ–∏</span>
                                <img id="img-preview">
                            </label>

                            <button id="add-btn" onclick="saveProduct()" class="btn-sm" style="height: 55px; font-size: 1.1rem; margin-top: 10px; width: 100%;">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –±–ª—é–¥–æ</button>
                            
                            <h3 style="margin-top: 40px; color: #c48c5d; border-bottom: 1px solid #333; padding-bottom: 10px;">–¢–µ–∫—É—â–µ–µ –º–µ–Ω—é:</h3>
                            <div id="product-list"></div>
                        </div>
                    `;
                    fetchList();
                } else {
                    alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!");
                }
            });
        }

        function showPreview(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = document.getElementById('img-preview');
                    img.src = e.target.result;
                    img.style.display = 'block';
                    document.getElementById('upload-label').innerText = "–§–æ—Ç–æ –≤—ã–±—Ä–∞–Ω–æ ‚úÖ";
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        async function saveProduct() {
            const nameInput = document.getElementById('p-name');
            const priceInput = document.getElementById('p-price');
            const descInput = document.getElementById('p-desc');
            const countInput = document.getElementById('p-count');
            const catInput = document.getElementById('p-cat');
            const badgeInput = document.getElementById('product-badge');
            const fileInput = document.getElementById('p-file');
            const btn = document.getElementById('add-btn');

            if (!nameInput.value || !priceInput.value || !fileInput.files[0]) {
                alert("–ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–ª—è –∏ –≤—ã–±–µ—Ä–∏ —Ñ–æ—Ç–æ!");
                return;
            }

            btn.disabled = true;
            btn.innerText = "‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ...";

            try {
                const formData = new FormData();
                formData.append("image", fileInput.files[0]);
                const res = await fetch(`https://api.imgbb.com/1/upload?key=${imgbbKey}`, {
                    method: "POST",
                    body: formData
                });
                const resData = await res.json();

                if (resData.success) {
                    await db.ref('products').push({
                        name: nameInput.value,
                        price: parseInt(priceInput.value),
                        desc: descInput.value,
                        count: countInput.value,
                        img: resData.data.url,
                        cat: catInput.value,
                        badge: badgeInput.value
                    });

                    alert("‚úÖ –ë–ª—é–¥–æ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ!");

                    nameInput.value = '';
                    priceInput.value = '';
                    descInput.value = '';
                    countInput.value = '';
                    fileInput.value = '';
                    badgeInput.value = '';
                    document.getElementById('img-preview').style.display = 'none';
                    document.getElementById('upload-label').innerText = "üì∏ –í—ã–±—Ä–∞—Ç—å —Ñ–æ—Ç–æ –∏–∑ –≥–∞–ª–µ—Ä–µ–∏";

                    btn.disabled = false;
                    btn.innerText = "–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –±–ª—é–¥–æ";

                } else {
                    alert("–û—à–∏–±–∫–∞ ImgBB");
                    btn.disabled = false;
                    btn.innerText = "–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –±–ª—é–¥–æ";
                }
            } catch (err) {
                alert("–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è!");
                btn.disabled = false;
                btn.innerText = "–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –±–ª—é–¥–æ";
            }
        }

        function fetchList() {
            db.ref('products').on('value', s => {
                const container = document.getElementById('product-list');
                const data = s.val();
                if (!container) return;
                container.innerHTML = '';
                if (!data) return;
                Object.keys(data).forEach(id => {
                    const b = data[id].badge ? (data[id].badge === 'hit' ? ' [–•–ò–¢]' : ' [–ù–û–í–ò–ù–ö–ê]') : '';
                    container.innerHTML += `
                        <div class="list-item">
                            <span>${data[id].name} <small style="color: #c48c5d;">${b}</small></span>
                            <button class="btn-delete" onclick="deleteItem('${id}')">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>`;
                });
            });
        }

        function deleteItem(id) {
            if (confirm("–£–¥–∞–ª–∏—Ç—å –±–ª—é–¥–æ?")) db.ref('products/' + id).remove();
        }
    </script>
</body>

</html>